const moment=require("moment"),sizeUnit=["B|bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],sizeUnitSpare=["B|bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],sizeUnitRegx=sizeUnit.join("|"),sizeUnitSpareRegx=sizeUnitSpare.join("|");function extractNumber(e){const t=/\d+/.exec(e);return t?parseInt(t[0]):e}function extractFloat(e){const t=/(\d+(\.\d+)?)/.exec(e);return t?parseFloat(t[0]):e}function extractSizeText(e){const t=new RegExp(`(\\d+(\\.\\d+)?)(&nbsp;| )*(${sizeUnitRegx}|${sizeUnitSpareRegx})`,"gi").exec(e);return t?t[0]:e}module.exports={extractNumber:extractNumber,extractFloat:extractFloat,extractTextByNode(e){if(e){if(!Array.isArray(e))return e.textContent.trim();if(e.length>0)return e[0].textContent.trim()}return null},extractResolution(e){const t={"4K":"2160|4k","2K":"1440|2k","1080P":"1920|1080","720P":"1280|720"};for(let r in t)if(new RegExp(t[r],"i").test(e))return r},extractMagnet(e){if(e){if(/^(magnet:\?xt=urn:btih:)/.test(e))return e.toLowerCase();{let t=/[\da-zA-Z]{32,40}/.exec(e);return t?`magnet:?xt=urn:btih:${t[0]}`.toLowerCase():e}}return null},extractDate:function(e){if(e){const t=[{regx:/(\d{4})-(\d{1,2})-(\d{1,2})/,format:["YYYY-MM-DD"]},{regx:/(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})/,format:["YYYY-MM-DD HH:mm"]},{regx:/(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})/,format:["YYYY-MM-DD HH:mm:ss"]},{regx:/(\d{1,2})-(\d{1,2})(&nbsp;| )(\d{4})/,format:"MM-DD YYYY"},{regx:/(\d{1,2})-(\d{1,2})(&nbsp;| )(\d{2}):(\d{2})/,format:"MM-DD HH:mm"}];for(let r=0;r<t.length;r++){const n=t[r].regx;if(n.test(e)){const i=n.exec(e),a=i?i[0]:e;return moment(a,t[r].format).valueOf()}}let r=0,n="days";if(/yesterday|昨天/.test(e))r=1,n="days";else{const t=[{regx:/year|年/,name:"years"},{regx:/month|月/,name:"months"},{regx:/day|天/,name:"days"},{regx:/hours|小时/,name:"hour"},{regx:/minute|分钟/,name:"minutes"},{regx:/second|秒/,name:"seconds"}];r=extractNumber(e);for(let r=0;r<t.length;r++)if(t[r].regx.test(e)){n=t[r].name;break}}return moment().subtract(r,n).valueOf()}},extractFileSize(e){let t=extractSizeText(e);if(t){let r=-1;for(let t=sizeUnit.length-1;t>=0;t--)if(new RegExp(`${sizeUnit[t]}|${sizeUnitSpare[t]}`,"i").test(e)){r=t;break}return r>=0?parseInt(extractFloat(t)*Math.pow(1024,r)):t}return e},splitByFileSize(e){const t=new RegExp(`(\\d+(\\.\\d+)?) {1,3}(${sizeUnitRegx})$`,"gi"),r=t.exec(e),n=r?r[0]:e;return[e.replace(t,""),n].filter(e=>e.trim())}};